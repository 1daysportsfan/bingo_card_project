
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>棒球賓果卡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #ecf0f1;
      text-align: center;
    }

    .title-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
      gap: 10px;
    }

    #logo {
      width: 50px;
    }

    .title-text h1 {
      margin: 0;
      font-size: 22px;
    }

    .title-text small {
      font-size: 13px;
      color: #555;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 10px;
    }

    #bingo {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 3px;
      background: white;
      padding: 5px;
      width: 95vw;
      max-width: 500px;
    }

    .cell {
      border: 2px solid #444;
      padding: 6px;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      font-size: 13px;
      cursor: pointer;
      user-select: none;
    }

    .marked {
      background: #4CAF50;
      color: white;
      font-weight: bold;
    }

    .free {
      background: #ccc;
      font-weight: bold;
    }

    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 90%;
      max-width: 400px;
      margin: 0 auto;
    }

    select, input[type=number], button {
      padding: 10px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    button {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #2980b9;
    }

    .pdf-count-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pdf-count-row input {
      flex: 1;
    }

    #message {
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      color: #e74c3c;
    }

    @media print {
      .btn-group, select, input {
        display: none;
      }

      #message {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="title-container">
    <img id="logo" src="logo.png" alt="Logo" />
    <div class="title-text">
      <h1>棒球賓果卡</h1>
      <small>Baseball Bingo Card</small>
    </div>
  </div>

  <div class="main-container">
    <div id="bingo" class="bingo"></div>

    <div class="btn-group">
      <label for="lang">顯示語言：</label>
      <select id="lang" onchange="generateBingo()">
        <option value="zh">中文</option>
        <option value="en">English</option>
        <option value="both" selected>中英對照</option>
      </select>

      <div class="pdf-count-row">
        <input type="number" id="pdfCount" value="5" min="1" max="50" />
        <span>張</span>
      </div>

      <button onclick="generateBingo()">🔄 重新產生</button>
      <button onclick="window.print()">🖨️ 列印賓果卡</button>
      <button onclick="downloadAsImage()">📥 下載圖片</button>
      <button onclick="downloadPDF()">📄 批次匯出 PDF</button>
      <button onclick="location.href='help.html'">❓ 幫助說明</button>
    </div>

    <div id="message"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const events = [
      { zh: "全壘打", en: "Home Run" },
      { zh: "安打", en: "Base Hit" },
      { zh: "三振", en: "Strikeout" },
      { zh: "保送", en: "Walk" },
      { zh: "盜壘成功", en: "Stolen Base" },
      { zh: "雙殺守備", en: "Double Play" },
      { zh: "高飛犧牲打", en: "Sacrifice Fly" },
      { zh: "教練抗議", en: "Coach Arguing" },
      { zh: "挑戰成功", en: "Challenge Success" },
      { zh: "暴投", en: "Wild Pitch" },
      { zh: "再見安打", en: "Walk-off Hit" },
      { zh: "游擊美技", en: "Shortstop Gem" },
      { zh: "界外接殺", en: "Foul Out" },
      { zh: "捕逸", en: "Passed Ball" },
      { zh: "觸身球", en: "Hit by Pitch" },
      { zh: "失誤", en: "Error" },
      { zh: "滾地球出局", en: "Ground Out" },
      { zh: "飛球出局", en: "Fly Out" },
      { zh: "打擊延長", en: "Long At-Bat" },
      { zh: "再見全壘打", en: "Walk-off HR" },
      { zh: "野手選擇", en: "Fielder's Choice" },
      { zh: "外野助殺", en: "Outfield Assist" },
      { zh: "換守位置", en: "Position Change" },
      { zh: "觸擊成功", en: "Successful Bunt" },
      { zh: "投手換人", en: "Pitching Change" }
    ];

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function generateBingo() {
      const lang = document.getElementById('lang').value;
      const bingo = document.getElementById('bingo');
      bingo.innerHTML = '';
      const shuffled = shuffle([...events]);
      let count = 0;

      for (let i = 0; i < 25; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';

        if (i === 12) {
          cell.innerHTML = '<strong>Free Space</strong>';
          cell.classList.add('marked', 'free');
        } else {
          const e = shuffled[count++];
          if (lang === 'zh') cell.innerHTML = e.zh;
          else if (lang === 'en') cell.innerHTML = e.en;
          else cell.innerHTML = `<div>${e.zh}</div><div style="font-size:11px; color:#666;">${e.en}</div>`;
          cell.onclick = () => {
            cell.classList.toggle('marked');
            checkBingo();
          };
        }

        bingo.appendChild(cell);
      }

      document.getElementById('message').innerHTML = '';
    }

    function checkBingo() {
      const cells = document.querySelectorAll('.cell');
      const indexes = [...Array(25).keys()];
      const lines = [];

      for (let i = 0; i < 5; i++) {
        lines.push(indexes.slice(i * 5, i * 5 + 5)); // row
        lines.push(indexes.filter((_, j) => j % 5 === i)); // column
      }
      lines.push([0, 6, 12, 18, 24]); // diagonal
      lines.push([4, 8, 12, 16, 20]); // anti-diagonal

      for (const line of lines) {
        if (line.every(i => cells[i].classList.contains('marked'))) {
          document.getElementById('message').innerHTML = '🎉 BINGO！恭喜你完成一列！🎉';
          return;
        }
      }

      document.getElementById('message').innerHTML = '';
    }

    function downloadAsImage() {
      html2canvas(document.getElementById('bingo')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'bingo_card.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    async function downloadPDF() {
      const count = parseInt(document.getElementById('pdfCount').value);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();

      for (let i = 0; i < count; i++) {
        generateBingo();
        await html2canvas(document.getElementById('bingo')).then(canvas => {
          const img = canvas.toDataURL();
          if (i > 0) pdf.addPage();
          pdf.text(`棒球賓果卡 #${i + 1}`, 10, 10);
          pdf.addImage(img, 'PNG', 10, 20, 190, 190);
        });
      }

      pdf.save("bingo_cards.pdf");
    }

    generateBingo();
  </script>
</body>
</html>
